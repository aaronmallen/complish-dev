#!/usr/bin/env sh
#MISE description="Lint Rust files"
#MISE alias=["l:rust", "lint:rust"]
#USAGE flag "--fix" help="Auto-fix issues where possible"

set -eu

FIX_MODE=false
while [ $# -gt 0 ]; do
  case $1 in
    --fix)
      FIX_MODE=true
      shift
      ;;
    -h | --help)
      echo "Usage: $0 [--fix]"
      echo "  --fix    Auto-fix issues where possible"
      exit 0
      ;;
    *)
      echo "Unknown option: $1" >&2
      echo "Use --help for usage information"
      exit 1
      ;;
  esac
done

if [ "${usage_fix:-}" = "true" ]; then
  FIX_MODE=true
fi

if [ "$FIX_MODE" = "true" ]; then
  cargo sort -w
  cargo +nightly fmt --all
  cargo clippy --all-targets --fix --allow-dirty --allow-staged
else
  cargo sort -w --check
  cargo +nightly fmt --all --check
  cargo clippy --all-targets
fi
